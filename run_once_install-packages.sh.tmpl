#!/bin/sh

if ! command -v brew &> /dev/null
then
    echo "brew could not be found, installing now"
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

{{ if eq .chezmoi.os "linux" -}}

sudo apt update
sudo apt install -y ack git htop tmux tree zsh

{{ else if eq .chezmoi.os "darwin" -}}

# Install Homebrew
if [ ! command -v brew &> /dev/null ]; then
    eval "$(/opt/homebrew/bin/brew shellenv)"
fi

{{ end -}}

# Brew packages
for PACKAGE in ack chezmoi git git-delta gitui grep htop mosh neovim openssh starship tmux tree zsh code-minimap kubectl

do
	brew list $PACKAGE || brew install $PACKAGE
done

# Install fzf
if [ ! -d "$HOME/.fzf" ] 
then
    echo "fzf could not be found, installing now"
    git clone --depth 1 https://github.com/junegunn/fzf.git $HOME/.fzf
    $HOME/.fzf/install --bin
fi

# Install oh my zsh
if [ ! -d "$HOME/.oh-my-zsh" ] 
then
    echo "Oh-My-Zsh is not installed, installing now" 
    git clone https://github.com/ohmyzsh/ohmyzsh.git $HOME/.oh-my-zsh
    chsh -s $(which zsh)
fi

# Install Packer NeoVim Package Management
if [ ! -d "$HOME/.local/share/nvim/site/pack/packer/start/packer.nvim" ] 
then
    git clone --depth 1 https://github.com/wbthomason/packer.nvim\
        $HOME/.local/share/nvim/site/pack/packer/start/packer.nvim
fi
